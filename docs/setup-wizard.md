# Zen CLI Setup Wizard

## Overview

The `zen setup` command provides an interactive wizard to configure Zen CLI. It guides you through setting up API keys and storage preferences, creating or updating your `~/.zen/.env` file.

## Quick Start

```bash
zen setup
```

This launches the interactive setup wizard.

## Features

### ğŸ” Secure API Key Handling
- **Masked Display**: Existing API keys shown as `AIzaSy...abc123` (first 6 + last 6 characters)
- **Secure Storage**: `.env` file created with `600` permissions (owner read/write only)
- **Smart Prompts**: Press Enter to keep existing values

### ğŸ¯ Guided Configuration

The wizard walks you through:

1. **Required API Keys**
   - Google Gemini API Key (required)
   - OpenAI API Key (recommended)

2. **Optional API Keys**
   - Anthropic API Key
   - XAI (Grok) API Key
   - OpenRouter API Key

3. **Storage Configuration**
   - File-based storage (recommended, zero dependencies)
   - Redis storage (for distributed/team environments)
   - In-memory storage (testing only)

4. **Redis Configuration** (if Redis selected)
   - Host, port, database number
   - Password (optional)
   - Key prefix for namespacing

## Usage Examples

### First-Time Setup

```bash
$ zen setup

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚         Zen CLI Setup Wizard                         â”‚
â”‚                                                      â”‚
â”‚ This wizard will help you configure Zen CLI.        â”‚
â”‚ Press Enter to keep existing values, or type new    â”‚
â”‚ values to update.                                    â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

No existing configuration found. Creating new ~/.zen/.env

â•â•â• API Keys â•â•â•
Configure API keys for different AI providers

Google Gemini API Key (required): AIzaSy...
OpenAI API Key: sk-proj-...
Configure optional API keys? (Anthropic, XAI, OpenRouter) [y/N]: n

â•â•â• Storage Configuration â•â•â•
Choose where to store conversation history

Storage backends:
  file   - Local file storage (recommended, zero dependencies)
  redis  - Redis storage (for distributed/team environments)
  memory - In-memory storage (ephemeral, testing only)

Storage backend [file/redis/memory] (file): file

Save configuration? [Y/n]: Y

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ âœ“ Configuration saved successfully!                  â”‚
â”‚                                                      â”‚
â”‚ Location: /Users/you/.zen/.env                      â”‚
â”‚ Permissions: 600 (owner read/write only)            â”‚
â”‚                                                      â”‚
â”‚ Test your setup with: zen listmodels                â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

Configured Providers:
  âœ“ Google Gemini
  âœ“ OpenAI

Storage: file
```

### Updating Existing Configuration

```bash
$ zen setup

Found existing configuration at ~/.zen/.env

â•â•â• API Keys â•â•â•
Configure API keys for different AI providers

Google Gemini API Key (current: AIzaSy...abc123): [Press Enter to keep]
OpenAI API Key (current: sk-pro...xyz789): sk-proj-NEW_KEY_HERE
Configure optional API keys? [y/N]: y

Anthropic API Key (current: sk-ant...def456): [Press Enter to keep]
XAI (Grok) API Key: xai-NEW_KEY
OpenRouter API Key (current: sk-or-...ghi789): [Press Enter to keep]

â•â•â• Storage Configuration â•â•â•
Storage backend [file/redis/memory] (file): redis

Redis Configuration

Redis host (current: localhost): [Press Enter to keep]
Redis port (current: 6379): [Press Enter to keep]
Redis database number (current: 0): 1
Set Redis password? [y/N]: n
Redis key prefix (current: zen:): [Press Enter to keep]

Save configuration? [Y/n]: Y

â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚ âœ“ Configuration saved successfully!                  â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯

Configured Providers:
  âœ“ Google Gemini
  âœ“ OpenAI
  âœ“ Anthropic
  âœ“ XAI (Grok)
  âœ“ OpenRouter

Storage: redis
```

## Configuration File Format

The setup wizard creates a well-organized `.env` file:

```bash
# Zen CLI Configuration
# Generated by zen setup on /Users/username
# Edit this file manually or run 'zen setup' again to update

# â•â•â• API Keys â•â•â•
ANTHROPIC_API_KEY="sk-ant-..."
GEMINI_API_KEY="AIzaSy..."
OPENAI_API_KEY="sk-proj-..."
XAI_API_KEY="xai-..."

# â•â•â• Storage Configuration â•â•â•
ZEN_STORAGE_TYPE="file"

# â•â•â• Other Configuration â•â•â•
# Add custom settings here
```

## Security Features

### File Permissions
The setup wizard automatically sets `.env` permissions to `600`:
- **Owner**: Read and write
- **Group**: No access
- **Others**: No access

### API Key Masking
When displaying existing keys:
- **Short keys (<20 chars)**: Shown as `****`
- **Long keys**: Shown as `AIzaSy...abc123` (first 6 + last 6)
- **Never logged**: Keys never appear in logs or error messages

## Best Practices

### 1. Run Setup After Installation
```bash
pip install zen-cli
zen setup  # Configure before first use
zen listmodels  # Verify configuration
```

### 2. Update Keys Regularly
```bash
zen setup  # Re-run to update expired or rotated keys
```

### 3. Team Environments
For team setups with Redis:
```bash
zen setup
# Select Redis storage
# Configure shared Redis instance
```

### 4. Multiple Environments
For different projects/environments:
```bash
# Development
export ZEN_STORAGE_TYPE=file
zen setup

# Production
export ZEN_STORAGE_TYPE=redis
export REDIS_HOST=prod-redis.example.com
zen setup
```

## Troubleshooting

### Permission Denied
```bash
$ zen setup
Error: Permission denied writing to ~/.zen/

# Fix:
chmod 755 ~/.zen
zen setup
```

### Invalid API Key Format
If prompted to enter a key again:
- Ensure no extra spaces or quotes
- Copy directly from provider dashboard
- Verify key format matches provider requirements

### Configuration Not Taking Effect
```bash
# Verify .env file was created
cat ~/.zen/.env

# Check file permissions
ls -la ~/.zen/.env
# Should show: -rw------- (600)

# Reload environment (if needed)
# Restart terminal or:
source ~/.zen/.env
```

## Manual Configuration

If you prefer to edit `.env` manually:

```bash
# Create directory
mkdir -p ~/.zen

# Edit configuration
nano ~/.zen/.env

# Set permissions
chmod 600 ~/.zen/.env
```

Required format:
```bash
GEMINI_API_KEY="your-key-here"
OPENAI_API_KEY="your-key-here"
ZEN_STORAGE_TYPE="file"
```

## Advanced Options

### Environment Variable Override
Configuration can be overridden with environment variables:

```bash
# Temporary override
GEMINI_API_KEY="temp-key" zen chat "hello"

# Session override
export OPENAI_API_KEY="session-key"
zen chat "test" --model gpt-4
```

### Storage Backend Selection
Configure via setup wizard or manually:

**File Storage** (default):
```bash
ZEN_STORAGE_TYPE="file"
```

**Redis Storage**:
```bash
ZEN_STORAGE_TYPE="redis"
REDIS_HOST="localhost"
REDIS_PORT="6379"
REDIS_DB="0"
REDIS_KEY_PREFIX="zen:"
```

**Memory Storage** (testing):
```bash
ZEN_STORAGE_TYPE="memory"
```

## See Also

- [Getting Started](getting-started.md)
- [Configuration Guide](configuration.md)
- [Storage Backends](storage-backends.md)
- [API Keys Setup](../README.md#api-keys)

---

**Quick Links:**
- Run setup: `zen setup`
- Test configuration: `zen listmodels`
- Get help: `zen setup --help`
